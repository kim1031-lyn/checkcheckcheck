<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>CheckCheckCheck</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
:root {
  /* ä¸»è‰²è°ƒ - é«˜çº§è“ç´«æ¸å˜è‰²ç³» */
  --primary-color: #4a6cf7;
  --primary-light: #6e8aff;
  --primary-dark: #3a56d4;
  --primary-gradient: linear-gradient(135deg, #4a6cf7 0%, #6e8aff 100%);
  --secondary-color: #5e60ce;
  --accent-color: #7400b8;
  --success-color: #0cce6b;
  --success-light: rgba(12, 206, 107, 0.1);
  --warning-color: #ffbe0b;
  --warning-light: rgba(255, 190, 11, 0.1);
  --error-color: #ff5470;
  --error-light: rgba(255, 84, 112, 0.1);
  --info-color: #3abff8;
  --info-light: rgba(58, 191, 248, 0.1);
  --bg-color: #ffffff;
  --bg-secondary: #f8faff;
  --bg-tertiary: #eef2ff;
  --card-bg: #ffffff;
  --text-primary: #1e293b;
  --text-secondary: #64748b;
  --text-tertiary: #94a3b8;
  --text-light: #f8fafc;
  --border-color: #e2e8f0;
  --border-light: #f1f5f9;
  --shadow-color: rgba(0, 0, 0, 0.05);
  --shadow-sm: 0 2px 4px var(--shadow-color);
  --shadow-md: 0 4px 12px var(--shadow-color);
  --shadow-lg: 0 10px 25px var(--shadow-color);
  --shadow-card: 0 10px 30px rgba(0, 0, 0, 0.04);
  --radius-sm: 6px;
  --radius-md: 10px;
  --radius-lg: 16px;
  --radius-xl: 24px;
  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --table-header-bg: #f8faff;
  --table-row-hover: #eef2ff;
}

    body.dark {
      --bg-color: #121212;
      --text-color: #ddd;
      --card-bg: #1e1e1e;
      --primary-color: #4dabf7;
      --table-header-bg: #1f2b3a;
      --shadow-color: rgba(0,0,0,0.4);
    }

    body {
      font-family: var(--font-sans);
      background: linear-gradient(135deg, #f8faff 0%, #eef2ff 100%);
      padding: 0;
      margin: 0;
      color: var(--text-primary);
      transition: all var(--transition-normal);
      line-height: 1.6;
      min-height: 100vh;
    }

    .container {
      max-width: 1800px; /* ç»´æŒä¸Šæ¬¡å¢åŠ çš„é¡µé¢æœ€å¤§å®½åº¦ */
      margin: 0 auto;
      padding: 40px 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 60px;
      padding: 40px 0;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: white;
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      margin-bottom: 40px;
    }

    h1 {
      font-size: 3.2em;
      margin: 0;
      font-weight: 700;
      letter-spacing: -1px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .subtitle {
      font-size: 1.2em;
      margin-top: 10px;
      opacity: 0.9;
      font-weight: 300;
    }

    .input-section {
      background: white;
      border-radius: var(--radius-xl);
      padding: 40px;
      margin-bottom: 40px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.08);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .input-section h2 {
      font-size: 1.8em;
      margin-bottom: 24px;
      color: var(--text-primary);
      font-weight: 600;
    }

    textarea {
      width: 100%;
      padding: 20px;
      margin: 0 0 24px;
      font-size: 16px;
      border-radius: var(--radius-lg);
      border: 2px solid var(--border-light);
      box-sizing: border-box;
      background: var(--bg-secondary);
      color: var(--text-primary);
      transition: all var(--transition-fast);
      resize: vertical;
      min-height: 120px;
      font-family: var(--font-sans);
    }

    textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.1);
    }

    input[type="file"], select {
      width: 100%;
      padding: 16px;
      margin: 0 0 20px;
      font-size: 16px;
      border-radius: var(--radius-lg);
      border: 2px solid var(--border-light);
      box-sizing: border-box;
      background: white;
      color: var(--text-primary);
      transition: all var(--transition-fast);
    }

    input[type="file"]:focus, select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.1);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: white;
      font-weight: 600;
      border: none;
      cursor: pointer;
      padding: 16px 32px;
      border-radius: var(--radius-lg);
      font-size: 16px;
      box-shadow: 0 4px 16px rgba(74, 108, 247, 0.3);
      transition: all var(--transition-fast);
      position: relative;
      overflow: hidden;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(74, 108, 247, 0.4);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: white;
      color: var(--primary-color);
      font-weight: 600;
      border: 2px solid var(--primary-color);
      cursor: pointer;
      padding: 12px 24px;
      border-radius: var(--radius-md);
      font-size: 14px;
      transition: all var(--transition-fast);
    }

    .btn-secondary:hover {
      background: var(--primary-color);
      color: white;
    }

    .result-area {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 0; /* ç§»é™¤ result-area çš„å†…è¾¹è·ï¼Œè®©è¡¨æ ¼å®Œå…¨å¡«å…… */
      border: 1px solid var(--border-light);
      max-height: 600px;
      overflow-y: auto; /* å…è®¸å‚ç›´æ»šåŠ¨ */
      transition: all var(--transition-normal); /* è°ƒæ•´è¿‡æ¸¡æ—¶é—´ */
    }

    .result-area:empty {
      display: none;
    }

    /* ç­›é€‰å™¨æ ·å¼ */
    .selectors {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      padding: 16px; /* ä¸ºç­›é€‰å™¨å¢åŠ å†…è¾¹è·ï¼Œä½¿å…¶ä¸è¡¨æ ¼å†…å®¹åŒºåˆ† */
      background: var(--bg-color); /* ç­›é€‰å™¨èƒŒæ™¯è‰² */
      border-bottom: 1px solid var(--border-light);
      border-top-left-radius: var(--radius-lg); /* é¡¶éƒ¨åœ†è§’ */
      border-top-right-radius: var(--radius-lg);
    }

    select {
      flex-grow: 1;
      max-width: 48%;
    }
    
    /* è°ƒæ•´é€‰æ‹©å™¨çš„æ ·å¼ï¼Œä½¿å…¶æ›´åè°ƒ */
    .selectors select {
        padding: 12px;
        border-radius: var(--radius-md);
        border: 1px solid var(--border-color);
        background: var(--bg-secondary);
        color: var(--text-primary);
    }
    .selectors select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.1);
    }


    select option.invalid {
      color: red !important;
    }

    /* è¡¨æ ¼æ ·å¼ä¼˜åŒ– */
    table {
      width: 100%; /* è¡¨æ ¼å®½åº¦å æ»¡å¯ç”¨ç©ºé—´ */
      table-layout: fixed; /* å…³é”®ï¼šå›ºå®šè¡¨æ ¼å¸ƒå±€ï¼Œç²¾ç¡®æ§åˆ¶åˆ—å®½ */
      border-collapse: separate;
      border-spacing: 0;
      margin-top: 0; /* ç§»é™¤é¡¶éƒ¨é—´è·ï¼Œç´§è·Ÿç­›é€‰å™¨ */
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }

    th, td {
      padding: 12px 16px; /* å•å…ƒæ ¼å†…è¾¹è· */
      text-align: left;
      /* å…è®¸æ–‡æœ¬åœ¨å¿…è¦æ—¶è‡ªåŠ¨æ¢è¡Œ */
      white-space: normal;
      overflow-wrap: break-word; /* å…è®¸åœ¨å•è¯å†…éƒ¨æ¢è¡Œï¼Œé˜²æ­¢è¶…é•¿å•è¯æº¢å‡º */
      word-break: break-word; /* å…¼å®¹æ€§å›é€€ */
      border-bottom: 1px solid var(--border-light);
      vertical-align: top; /* ç¡®ä¿å†…å®¹é¡¶éƒ¨å¯¹é½ */
    }

    /* åˆ—å®½åˆ†é…ï¼šä½¿ç”¨ç™¾åˆ†æ¯”å’Œæœ€å°å®½åº¦ç¡®ä¿åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹çš„åˆç†å¸ƒå±€ */
    th:nth-child(1), td:nth-child(1) { width: 25%; min-width: 200px; } /* æ¥æºé¡µé¢ */
    th:nth-child(2), td:nth-child(2) { width: 20%; min-width: 180px; } /* é”šæ–‡æœ¬ */
    th:nth-child(3), td:nth-child(3) { width: 35%; min-width: 280px; } /* ç›®æ ‡é“¾æ¥ï¼Œç»™æœ€å¤šç©ºé—´ */
    th:nth-child(4), td:nth-child(4) { width: 15%; min-width: 150px; } /* ç›®æ ‡åŸŸå */
    th:nth-child(5), td:nth-child(5) { width: 5%; min-width: 80px; } /* é“¾æ¥ç±»å‹ */


    th {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: white;
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      position: sticky;
      top: 0;
      z-index: 2;
    }

    th:first-child {
      border-top-left-radius: var(--radius-lg);
    }

    th:last-child {
      border-top-right-radius: var(--radius-lg);
    }

    tbody tr {
      transition: all var(--transition-fast);
    }

    tbody tr:hover {
      background-color: var(--bg-secondary);
      transform: scale(1.01);
    }

    tbody tr:nth-child(even) {
      background-color: rgba(248, 250, 255, 0.5);
    }

    tbody tr:last-child td:first-child {
      border-bottom-left-radius: var(--radius-lg);
    }

    tbody tr:last-child td:last-child {
      border-bottom-right-radius: var(--radius-lg);
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    /* åŒ…è£¹æ–‡æœ¬å’Œå¤åˆ¶æŒ‰é’®çš„å®¹å™¨ */
    .cell-content-wrapper {
        display: flex; /* ä½¿ç”¨ Flexbox å¸ƒå±€ */
        align-items: flex-start; /* å†…å®¹é¡¶éƒ¨å¯¹é½ */
        gap: 8px; /* æ–‡æœ¬å’ŒæŒ‰é’®ä¹‹é—´çš„é—´è· */
        width: 100%; /* ç¡®ä¿ wrapper å æ®å•å…ƒæ ¼æ‰€æœ‰å®½åº¦ */
        flex-wrap: wrap; /* å…è®¸å†…å®¹æ¢è¡Œ */
    }

    /* æ–‡æœ¬å’Œé“¾æ¥å°†å…è®¸æ¢è¡Œï¼Œä¸å†å¼ºåˆ¶å•è¡Œå’Œçœç•¥å· */
    .cell-content-wrapper span,
    .cell-content-wrapper a {
        flex-grow: 1; /* è®©æ–‡æœ¬æˆ–é“¾æ¥å æ®å‰©ä½™ç©ºé—´ */
        display: block; /* ç¡®ä¿å æ®å®Œæ•´å®½åº¦ä»¥ä¾¿æ¢è¡Œ */
        min-width: 0; /* å…è®¸åœ¨ flex å®¹å™¨ä¸­æ”¶ç¼© */
        word-break: break-word; /* ç¡®ä¿é•¿å•è¯ä¹Ÿèƒ½æ¢è¡Œ */
    }


    /* å¤åˆ¶æŒ‰é’®æ ·å¼ */
    .copy-btn {
      margin-left: 0; /* ç”± flex gap æ§åˆ¶é—´è· */
      padding: 4px 8px; /* ç¨å¾®ç¼©å°æŒ‰é’®å†…è¾¹è· */
      font-size: 0.75em; /* å‡å°å­—ä½“å¤§å° */
      background: var(--bg-tertiary); /* ä½¿ç”¨æ›´æŸ”å’Œçš„èƒŒæ™¯è‰² */
      border: 1px solid var(--border-color); /* æ›´ç»†çš„è¾¹æ¡† */
      border-radius: var(--radius-sm);
      cursor: pointer;
      color: var(--text-secondary);
      transition: all var(--transition-fast);
      font-weight: 500;
      flex-shrink: 0; /* é˜²æ­¢æŒ‰é’®è¢«æŒ¤å‹ï¼Œå®ƒæœ‰å›ºå®šçš„å®½åº¦ */
      white-space: nowrap; /* æŒ‰é’®æ–‡æœ¬ä¸æ¢è¡Œ */
      line-height: 1; /* è°ƒæ•´è¡Œé«˜ä½¿æŒ‰é’®æ›´ç´§å‡‘ */
      height: 24px; /* å›ºå®šæŒ‰é’®é«˜åº¦ */
      display: inline-flex; /* ä¿æŒ flex è¡Œä¸º */
      align-items: center; /* å‚ç›´å±…ä¸­æŒ‰é’®å†…å®¹ */
      justify-content: center; /* æ°´å¹³å±…ä¸­æŒ‰é’®å†…å®¹ */
    }

    .copy-btn:hover {
      background: var(--primary-light); /* æ‚¬åœæ—¶èƒŒæ™¯è‰²æ›´äº® */
      color: white;
      border-color: var(--primary-light);
      transform: scale(1.05);
    }

    .loading {
      font-style: italic;
      color: var(--text-secondary);
      padding: 24px; /* ç¡®ä¿loadingä¿¡æ¯æœ‰å†…è¾¹è· */
    }

    .error {
      color: var(--error-color);
      margin-top: 5px;
      padding: 24px; /* ç¡®ä¿errorä¿¡æ¯æœ‰å†…è¾¹è· */
    }

    .stats {
      color: var(--text-secondary);
      margin: 10px 0;
      padding: 0 24px 16px; /* ä¸ºç»Ÿè®¡ä¿¡æ¯æ·»åŠ å†…è¾¹è· */
      font-size: 0.95em;
    }

    /* æ‘˜è¦ä¿¡æ¯æ ·å¼ */
    .summary-info {
        background: var(--bg-color);
        border-bottom: 1px solid var(--border-light);
        padding: 16px 24px;
        font-size: 0.9em;
        color: var(--text-secondary);
        border-top-left-radius: var(--radius-lg);
        border-top-right-radius: var(--radius-lg);
        margin-top: 0;
        display: flex;
        flex-wrap: wrap; /* å…è®¸æ‘˜è¦é¡¹æ¢è¡Œ */
        gap: 15px; /* æ‘˜è¦é¡¹ä¹‹é—´çš„é—´è· */
        justify-content: space-around; /* è®©æ‘˜è¦é¡¹åˆ†æ•£å¯¹é½ */
    }
    .summary-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 5px 10px;
        border-radius: var(--radius-sm);
        background: var(--bg-secondary);
        box-shadow: var(--shadow-sm);
        flex: 1 1 auto; /* å…è®¸é¡¹ç›®å¢é•¿å’Œæ”¶ç¼© */
        min-width: 120px; /* æœ€å°å®½åº¦ï¼Œé˜²æ­¢è¿‡çª„ */
        box-sizing: border-box; /* ç¡®ä¿ padding åŒ…å«åœ¨å®½åº¦å†… */
    }
    .summary-label {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.8em;
        margin-bottom: 3px;
    }
    .summary-value {
        font-weight: 700;
        font-size: 1.2em;
        color: var(--primary-color);
    }


    .dofollow-text {
      color: var(--success-color);
      font-weight: 700;
      text-align: center;
    }

    .nofollow-text {
      color: var(--warning-color);
      font-weight: 700;
      text-align: center;
    }

    .pagination {
      margin-top: 15px;
      text-align: center;
    }

    .pagination {
      margin-top: 24px;
      text-align: center;
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
      padding: 0 24px 24px; /* ä¸ºåˆ†é¡µå™¨æ·»åŠ å†…è¾¹è· */
    }

    .pagination button {
      background: white;
      border: 2px solid var(--border-light);
      color: var(--text-primary);
      padding: 10px 16px;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      transition: all var(--transition-fast);
      min-width: 44px;
    }

    .pagination button:hover:not(:disabled) {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
      transform: translateY(-1px);
    }

    .pagination button:disabled {
      background: var(--bg-tertiary);
      color: var(--text-tertiary);
      cursor: not-allowed;
      border-color: var(--border-light);
    }

    .pagination button.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .invalid-domain {
      color: var(--error-color);
      font-weight: bold;
    }

    /* features-grid å¸ƒå±€è°ƒæ•´ */
    .features-grid {
      display: grid;
      grid-template-columns: 1fr; /* é»˜è®¤å•åˆ—å¸ƒå±€ï¼ˆå°å±å¹•ï¼‰*/
      gap: 30px;
      margin-top: 40px;
    }

    @media (min-width: 768px) { /* ä¸­ç­‰å±å¹•åŠä»¥ä¸Šæ”¹ä¸ºåŒåˆ— */
      .features-grid {
        grid-template-columns: 1fr 1fr; /* é»˜è®¤ä¸¤åˆ—ç­‰å®½ */
      }
    }

    @media (min-width: 992px) { /* å¤§å±å¹•ï¼ˆæ¡Œé¢ï¼‰æ—¶ï¼Œå³ä¾§å¡ç‰‡æ›´å®½ */
      .features-grid {
        /* å·¦ä¾§å 1ä»½ï¼Œå³ä¾§å 2.5ä»½ï¼Œä¸ºå³ä¾§è¡¨æ ¼æä¾›æ›´å¤šç©ºé—´ */
        grid-template-columns: 1fr 2.5fr; /* è°ƒæ•´æ¯”ä¾‹ï¼Œå³ä¾§æ›´å®½ */
      }
    }

    .feature-card {
      background: white;
      border-radius: var(--radius-xl);
      padding: 0; /* ç§»é™¤å¡ç‰‡å†…è¾¹è·ï¼Œè®©å†…å®¹ï¼ˆåŒ…æ‹¬ summary-info å’Œ selectorsï¼‰é“ºæ»¡ */
      box-shadow: 0 8px 32px rgba(0,0,0,0.08);
      border: 1px solid rgba(255,255,255,0.2);
      overflow: hidden; /* é˜²æ­¢å¡ç‰‡å†…å®¹æº¢å‡º */
      transition: all var(--transition-fast);
    }

    .feature-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 48px rgba(0,0,0,0.12);
    }

    .feature-header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: white;
      padding: 24px 32px;
      font-size: 1.4em;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .feature-content {
      /* feature-content çš„å†…è¾¹è·åªå½±å“å…¶ä¸‹çš„å†…å®¹ï¼Œä¸å½±å“ summary-info å’Œ selectors */
      padding: 0; /* ç§»é™¤ feature-content çš„å†…è¾¹è·ï¼Œè®©å†…éƒ¨å…ƒç´ æ§åˆ¶è‡ªå·±çš„é—´è· */
    }
  </style>
  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
</head>
<body>
<div class="dark-toggle" onclick="toggleDark()">ğŸŒ™ åˆ‡æ¢ä¸»é¢˜</div>

<div class="container">
  <div class="header">
    <h1>é”šæ–‡æœ¬æ£€æŸ¥å·¥å…·</h1>
    <div class="subtitle">ä¸“ä¸šçš„ç½‘é¡µé“¾æ¥åˆ†æä¸Wordæ–‡æ¡£å¤„ç†å¹³å°</div>
  </div>

  <div class="input-section">
    <h2>ğŸŒ æ‰¹é‡ç½‘é¡µé“¾æ¥åˆ†æ</h2>
    <textarea id="urlInput" rows="5" placeholder="è¯·è¾“å…¥è¦åˆ†æçš„ç½‘é¡µé“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ªï¼š\nhttps://example.com/page1\nhttps://example.com/page2\nhttps://example.com/page3"></textarea>
    <button class="btn-primary" onclick="startExtraction()">å¼€å§‹åˆ†æé“¾æ¥</button>
  </div>

  <div class="features-grid">
    <div class="feature-card">
      <div class="feature-header">
        ğŸ“„ Word æ–‡æ¡£å¤„ç†
      </div>
      <div class="feature-content">
        <div class="collapsible">
          <div id="docxBlock">
            <input type="file" id="docxInput" accept=".docx" placeholder="é€‰æ‹©Wordæ–‡æ¡£" />
            <button class="btn-primary" onclick="handleDocx()">ä¸Šä¼ å¹¶æå–é“¾æ¥</button>
            <div id="docxSummary" class="summary-info" style="display:none;"></div> <!-- æ–°å¢Wordæ–‡æ¡£æ‘˜è¦ -->
            <div id="docxResult" class="result-area"></div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="feature-card">
      <div class="feature-header">
        ğŸ” é“¾æ¥åˆ†æç»“æœ
      </div>
      <div class="feature-content">
        <div class="collapsible">
          <div id="webBlock">
            <div class="selectors" style="display:none;">
              <select id="sourceSelect" onchange="onSourceChange()"><option value="">æ‰€æœ‰æ¥æºé¡µé¢</option></select>
              <select id="domainSelect" onchange="onDomainChange()" disabled><option value="">æ‰€æœ‰ç›®æ ‡åŸŸå</option></select>
            </div>
            <div id="webSummary" class="summary-info" style="display:none;"></div> <!-- æ–°å¢Webé“¾æ¥æ‘˜è¦ -->
            <div id="stats" class="stats"></div> <!-- ä»ä¿ç•™ç”¨äºæ˜¾ç¤ºå½“å‰é¡µé¢çš„ç»Ÿè®¡ -->
            <div id="resultArea" class="result-area"></div>
            <div id="pagination" class="pagination"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  let allData = {}, inputOrder = [], filteredSource = '', filteredDomain = '', currentPage = 1, currentRows = [], pageSize = 50;

  function toggleDark() {
    document.body.classList.toggle('dark');
  }

  function toggleSection(id) {
    const el = document.getElementById(id);
    if (el) el.style.display = el.style.display === 'none' ? 'block' : 'none';
  }

  function getDomainFromURL(url) {
    try { 
        const urlObj = new URL(url);
        return urlObj.hostname.replace(/^www\./, ''); 
    }
    catch { 
        return 'æ— æ•ˆåŸŸåæˆ–æœªçŸ¥æ¥æº';
    }
  }

  async function fetchWithFallback(url) {
    const proxies = [u => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}`, u => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`];
    for (let proxy of proxies) {
      try {
        const res = await fetch(proxy(url));
        if (!res.ok) throw new Error(`çŠ¶æ€ ${res.status}`);
        return await res.text();
      } catch {}
    }
    throw new Error('æ‰€æœ‰ä»£ç†å¤±è´¥');
  }

async function fetchAndExtract(url) {
  const html = await fetchWithFallback(url);
  const doc = new DOMParser().parseFromString(html, 'text/html');

  const results = [];

  const selectors = ['main', 'article', '#content', '.post-content'];
  let container = selectors.map(s => doc.querySelector(s)).find(c => c);

  let anchors = [];
  if (container) {
    anchors = container.querySelectorAll('a[href]');
  }

  if (!anchors || anchors.length === 0) {
    container = doc.body;
    anchors = container.querySelectorAll('a[href]');
  }

  anchors.forEach(a => {
    const text = a.textContent.trim();
    const hrefRaw = a.getAttribute('href')?.trim();
    if (!hrefRaw || !text) return;

    let href;
    try {
      href = new URL(hrefRaw, url).href;
    } catch {
      href = hrefRaw;
    }

    const targetDomain = getDomainFromURL(href);
    const rel = a.getAttribute('rel') || '';
    const followType = rel.toLowerCase().includes('nofollow') ? 'nofollow' : 'dofollow';

    if (targetDomain && href) { 
      results.push({ text, href, targetDomain, followType });
    }
  });

  return results;
}


  async function startExtraction() {
    const input = document.getElementById('urlInput');
    const resultArea = document.getElementById('resultArea');
    const webSummary = document.getElementById('webSummary');
    const selectorsDiv = document.querySelector('.selectors');
    const pagination = document.getElementById('pagination');
    const stats = document.getElementById('stats');

    const rawUrls = input ? input.value.trim().split('\n').map(u => u.trim()).filter(Boolean) : [];
    const urls = [], seen = new Set();
    rawUrls.forEach(u => {
      try {
        const url = new URL(u).href;
        if (!seen.has(url)) {
          seen.add(url);
          urls.push(url);
        }
      } catch {}
    });
    inputOrder = [...urls];

    if (!urls.length) {
        if (resultArea) resultArea.innerHTML = '<p class="error">è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªæœ‰æ•ˆç½‘å€ã€‚</p>';
        if (webSummary) webSummary.style.display = 'none';
        if (selectorsDiv) selectorsDiv.style.display = 'none';
        if (stats) stats.textContent = '';
        if (pagination) pagination.innerHTML = '';
        return;
    }

    if (resultArea) resultArea.innerHTML = '<p class="loading">æŠ“å–ä¸­ï¼Œè¯·ç¨å€™...</p>';
    if (webSummary) webSummary.style.display = 'none';
    if (selectorsDiv) selectorsDiv.style.display = 'none';
    if (pagination) pagination.innerHTML = '';
    if (stats) stats.textContent = '';

    let allExtractedAnchors = [];
    for (const url of urls) {
      try {
        const anchors = await fetchAndExtract(url);
        allData[url] = anchors;
        allExtractedAnchors = allExtractedAnchors.concat(anchors);
      } catch (e) {
        const errP = document.createElement('p');
        errP.className = 'error';
        errP.textContent = `æŠ“å–å¤±è´¥ï¼š${url}ï¼ˆ${e.message}ï¼‰`;
        if (resultArea) resultArea.appendChild(errP);
      }
    }

    const orderedDomainSet = new Set();
    urls.forEach(u => {
      (allData[u] || []).forEach(a => {
        orderedDomainSet.add(a.targetDomain);
      });
    });

    const sourceSelect = document.getElementById('sourceSelect');
    if (sourceSelect) {
        sourceSelect.innerHTML = `<option value="">æ‰€æœ‰æ¥æºé¡µé¢</option>${urls.map(u => `<option value="${u}">${u}</option>`).join('')}`;
    }

    const domainSelect = document.getElementById('domainSelect');
    if (domainSelect) {
        domainSelect.innerHTML = `<option value="">æ‰€æœ‰ç›®æ ‡åŸŸå</option>`;
        orderedDomainSet.forEach(domain => {
            const isValid = domain !== 'æ— æ•ˆåŸŸåæˆ–æœªçŸ¥æ¥æº';
            const classStr = isValid ? '' : 'class="invalid"';
            domainSelect.innerHTML += `<option ${classStr} value="${domain}">${domain}</option>`;
        });
        domainSelect.disabled = false;
    }

    // æ›´æ–°Webé“¾æ¥åˆ†æçš„æ€»è§ˆæ‘˜è¦
    if (webSummary) {
        const totalWebLinks = allExtractedAnchors.length;
        const uniqueWebDomains = new Set(allExtractedAnchors.map(a => a.targetDomain)).size;
        const dofollowWebCount = allExtractedAnchors.filter(a => a.followType === 'dofollow').length;
        const nofollowWebCount = allExtractedAnchors.filter(a => a.followType === 'nofollow').length;

        webSummary.innerHTML = `
            <div class="summary-item"><span class="summary-label">æ€»é“¾æ¥æ•°</span><span class="summary-value">${totalWebLinks}</span></div>
            <div class="summary-item"><span class="summary-label">å”¯ä¸€åŸŸåæ•°</span><span class="summary-value">${uniqueWebDomains}</span></div>
            <div class="summary-item"><span class="summary-label">Dofollow</span><span class="summary-value">${dofollowWebCount}</span></div>
            <div class="summary-item"><span class="summary-label">Nofollow</span><span class="summary-value">${nofollowWebCount}</span></div>
        `;
        webSummary.style.display = 'flex';
    }

    if (selectorsDiv) selectorsDiv.style.display = 'flex';
    displayResults();
  }

  function onSourceChange() {
    filteredSource = document.getElementById('sourceSelect') ? document.getElementById('sourceSelect').value : '';
    filteredDomain = '';
    const domainSelect = document.getElementById('domainSelect');
    if (domainSelect) domainSelect.value = '';
    currentPage = 1;
    displayResults();
  }

  function onDomainChange() {
    filteredDomain = document.getElementById('domainSelect') ? document.getElementById('domainSelect').value : '';
    currentPage = 1;
    displayResults();
  }

  function copyToClipboard(text) {
    const textarea = document.createElement('textarea');
    textarea.value = text;
    textarea.style.position = 'fixed';
    textarea.style.left = '-9999px';
    document.body.appendChild(textarea);
    textarea.select();
    try {
        document.execCommand('copy');
    } catch (err) {
        console.error('å¤åˆ¶å¤±è´¥:', err);
        const messageDiv = document.createElement('div');
        messageDiv.textContent = 'æ— æ³•è‡ªåŠ¨å¤åˆ¶ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶æ–‡æœ¬ã€‚å·²å°†å…¶æ”¾ç½®åœ¨ä¸€ä¸ªä¸´æ—¶åŒºåŸŸï¼Œæ–¹ä¾¿æ‚¨å¤åˆ¶ã€‚';
        messageDiv.style.cssText = `
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8); color: white; padding: 15px 20px; border-radius: 8px;
            z-index: 10000; font-size: 14px; text-align: center;
        `;
        document.body.appendChild(messageDiv);
        setTimeout(() => {
            if (messageDiv && messageDiv.parentNode) {
                document.body.removeChild(messageDiv);
            }
        }, 3000);
    } finally {
        if (textarea && textarea.parentNode) {
            document.body.removeChild(textarea);
        }
    }
  }

  function displayResults() {
    const resultArea = document.getElementById('resultArea');
    const statsDiv = document.getElementById('stats');
    const paginationDiv = document.getElementById('pagination');

    if (resultArea) resultArea.innerHTML = '';
    let rows = [];

    const sources = filteredSource ? [filteredSource] : Object.keys(allData);
    sources.forEach(source => {
      (allData[source] || []).forEach(a => {
        if (!filteredDomain || a.targetDomain === filteredDomain)
          rows.push({ source, ...a });
      });
    });

    if (!rows.length) {
      if (resultArea) resultArea.innerHTML = '<p style="padding: 24px;">æ— åŒ¹é…çš„é”šæ–‡æœ¬ã€‚</p>';
      if (statsDiv) statsDiv.textContent = '';
      if (paginationDiv) paginationDiv.innerHTML = '';
      return;
    }

    currentRows = rows;
    
    if (statsDiv) statsDiv.textContent = `å½“å‰æ˜¾ç¤ºé”šæ–‡æœ¬æ€»æ•°ï¼š${rows.length}`;
    showPage(currentPage);
  }

  function showPage(page) {
    const resultArea = document.getElementById('resultArea');
    const pagination = document.getElementById('pagination');
    
    const start = (page - 1) * pageSize;
    const end = start + pageSize;
    const rows = currentRows.slice(start, end);

    const table = document.createElement('table');
    table.innerHTML = `<thead><tr><th>æ¥æºé¡µé¢</th><th>é”šæ–‡æœ¬</th><th>ç›®æ ‡é“¾æ¥</th><th>ç›®æ ‡åŸŸå</th><th>é“¾æ¥ç±»å‹</th></tr></thead>`;
    const tbody = document.createElement('tbody');

    rows.forEach(row => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>
          <div class="cell-content-wrapper">
            <span>${row.source}</span>
          </div>
        </td>
        <td>
          <div class="cell-content-wrapper">
            <span>${row.text}</span>
            <button class="copy-btn" onclick="copyToClipboard('${row.text.replace(/'/g, "\\'")}')">å¤åˆ¶</button>
          </div>
        </td>
        <td>
          <div class="cell-content-wrapper">
            <a href="${row.href}" target="_blank">${row.href}</a>
            <button class="copy-btn" onclick="copyToClipboard('${row.href.replace(/'/g, "\\'")}')">å¤åˆ¶</button>
          </div>
        </td>
        <td><span>${row.targetDomain}</span></td>
        <td class="${row.followType === 'nofollow' ? 'nofollow-text' : 'dofollow-text'}">${row.followType}</td>
      `;
      tbody.appendChild(tr);
    });

    table.appendChild(tbody);
    if (resultArea) {
      resultArea.innerHTML = '';
      resultArea.appendChild(table);
    }

    if (pagination) {
        pagination.innerHTML = '';
        const totalPages = Math.ceil(currentRows.length / pageSize);
        if (totalPages <= 1) return;

        const prev = document.createElement('button');
        prev.textContent = 'ä¸Šä¸€é¡µ';
        prev.disabled = page === 1;
        prev.onclick = () => { currentPage--; showPage(currentPage); };
        pagination.appendChild(prev);

        for (let i = 1; i <= totalPages; i++) {
            const btn = document.createElement('button');
            btn.textContent = i;
            btn.disabled = i === page;
            btn.onclick = () => { currentPage = i; showPage(i); };
            pagination.appendChild(btn);
        }

        const next = document.createElement('button');
        next.textContent = 'ä¸‹ä¸€é¡µ';
        next.disabled = page === totalPages;
        next.onclick = () => { currentPage++; showPage(currentPage); };
        pagination.appendChild(next);
    }
  }

  function handleDocx() {
    const input = document.getElementById('docxInput');
    const resultDiv = document.getElementById('docxResult');
    const summaryDiv = document.getElementById('docxSummary');

    if (resultDiv) resultDiv.innerHTML = '<p class="loading">æ­£åœ¨è§£æ Word æ–‡æ¡£...</p>';
    if (summaryDiv) summaryDiv.style.display = 'none';

    if (!input || !input.files.length) {
        if (resultDiv) resultDiv.innerHTML = '<p class="error">è¯·å…ˆé€‰æ‹© Word æ–‡ä»¶ã€‚</p>';
        return;
    }

    const reader = new FileReader();
    reader.onload = function(event) {
      mammoth.convertToHtml({ arrayBuffer: event.target.result }).then(result => {
        const html = result.value;
        const doc = new DOMParser().parseFromString(html, 'text/html');
        const links = doc.querySelectorAll('a[href]');
        if (!links.length) {
          if (resultDiv) resultDiv.innerHTML = '<p style="padding: 24px;">æœªæå–åˆ°ä»»ä½•é“¾æ¥ã€‚</p>';
          if (summaryDiv) summaryDiv.style.display = 'none';
          return;
        }

        let table = `<table><thead><tr><th>é”šæ–‡æœ¬</th><th>é“¾æ¥åœ°å€</th></tr></thead><tbody>`;
        const extractedLinks = [];
        let dofollowCount = 0;
        let nofollowCount = 0;

        links.forEach(a => {
          const text = a.textContent.trim();
          const href = a.getAttribute('href')?.trim();
          const rel = a.getAttribute('rel') || '';

          if (text && href) {
            extractedLinks.push({text, href, rel});

            if (rel.toLowerCase().includes('nofollow')) {
                nofollowCount++;
            } else {
                dofollowCount++;
            }

            const textHtml = `<span>${text}</span>`;
            const hrefHtml = `<a href="${href}" target="_blank">${href}</a>`;

            table += `<tr>
              <td>
                <div class="cell-content-wrapper">
                  ${textHtml}
                </div>
              </td>
              <td>
                <div class="cell-content-wrapper">
                  ${hrefHtml}
                </div>
              </td>
            </tr>`;
          }
        });
        table += '</tbody></table>';
        if (resultDiv) resultDiv.innerHTML = table;

        // è®¡ç®—å¹¶æ˜¾ç¤ºWordæ–‡æ¡£æ‘˜è¦
        const uniqueDomains = new Set(extractedLinks.map(link => getDomainFromURL(link.href)));
        if (summaryDiv) {
            summaryDiv.innerHTML = `
                <div class="summary-item"><span class="summary-label">æ€»é“¾æ¥æ•°</span><span class="summary-value">${extractedLinks.length}</span></div>
                <div class="summary-item"><span class="summary-label">å”¯ä¸€åŸŸåæ•°</span><span class="summary-value">${uniqueDomains.size}</span></div>
                <div class="summary-item"><span class="summary-label">Dofollow</span><span class="summary-value">${dofollowCount}</span></div>
                <div class="summary-item"><span class="summary-label">Nofollow</span><span class="summary-value">${nofollowCount}</span></div>
            `;
            summaryDiv.style.display = 'flex';
        }

      }).catch(err => {
        if (resultDiv) resultDiv.innerHTML = `<p class="error">è§£æå¤±è´¥ï¼š${err.message}</p>`;
        if (summaryDiv) summaryDiv.style.display = 'none';
      });
    };
    if (input.files[0]) {
        reader.readAsArrayBuffer(input.files[0]);
    }
  }
</script>
</body>
</html>
